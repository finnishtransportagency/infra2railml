# Infra-API transformation to railML v2.2

Converts selected data sets from https://rata.digitraffic.fi/infra-api/0.3 to railML v2.2, mainly to be imported in OpenTrack simulation software.

## Requirements

- Git client
- Node.js v10.15.3
- NPM v6.4.1

## Setup & Installation

- [NVM](https://github.com/creationix/nvm) is recommended for installing Node.js and NPM.
- Clone the source code repository
    - `git clone <this repository>`
- Go to infra2railml directory
- Install dependencies and create a symlink for the 
    - `npm install && npm link`
- Confirm the `infra2railml` command is found in PATH
    - `infra2railml --version`

## Usage

For general usage and options, see `infra2railml --help`.

### Railway Infrastucture

Infrastructure model is generated by by giving a track ID, first kilometer and last kilometer. The given kilometers are inclusive, but notice that all rails that span over the requested scope are also included with full length but fewer details. Desired track length may also be given instead of end kilometer. For example, track 007 kilometers 28 through 37 (i.e. 10 kilometers):

- `infra2railml 007 --from 28 --to 37`
- `infra2railml 007 --from 28 --length 10`

Each individual rail (raide) will result in railML track element, including the relevant/chosen track elements, switch connections, speed limits etc. No visualization is defined at the moment.

### Stations

- TODO

## Implementation Details

### Naming Conventions

The API and railML terminology is overlapping but in the API everything is given in Finnish. Hence, to avoid confusion, Finnish terms are generally used to refer to API structrues and variables, while English is used for railML and general code.

### Terminology Mapping

The terminology is mapped between Infra API and railML as follows:

|Infra API term             |Corresponding or related railML 2.2 terms      |Notes
|---                        |---                                            |---
|raide                      |track                                          |Also "rail" in source code
|vaihde                     |switch                                         |elementti/vaihde
|raideristeys               |crossing                                       |elementti/vaihde
|baliisi                    |balise                                         |elementti/baliisi
|opastin                    |signal                                         |elementti/opastin
|kilometripaalu             |signal/milepost                                |"ratakilometri"
|sijainti (km + etaisyys)   |pos, absPos, mileageChange                     |Calculated relative to track begin
|raide-eristys              |electrificationChange                          |Is this correct?
|nopeusrajoitukset          |speedChange, infraAttributes/speed             |


### Identifiers

The API identifies objects with unique identifiers given in the field `tunniste`. However, in railML it is common we also need to identify and reference various child elements nested under the main object element. Thus, to avoid artificial IDs and make it easier to refer children from other contexts, the IDs are prefixed with abbreviations based on object type. In some cases the IDs are also suffixed with abbreviations or position on track to ensure the uniqueness of IDs. For example,

|Object/Child                   |Infra-API object ID            |Corresponding railML ID
|---                            |---                            |---
|track                          |x.x.xxx.LIVI.INFRA.44.117326   |x.x.xxx.LIVI.INFRA.44.117326	
|track/trackBegin               |-                              |tb_x.x.xxx.LIVI.INFRA.44.117326
|track/trackBegin/connection    |-                              |tbc_x.x.xxx.LIVI.INFRA.44.117326
|track/trackEnd                 |-                              |te_x.x.xxx.LIVI.INFRA.44.117326
|track/trackEnd/connection      |-                              |tec_x.x.xxx.LIVI.INFRA.44.117326
|switch                         |x.x.xxx.LIVI.INFRA.24.102936   |x.x.xxx.LIVI.INFRA.24.102936
|switch/connection              |-                              |swc_x.x.xxx.LIVI.INFRA.24.102936

The above is only to give the general idea more concretely, in practice there are many more.

### Signals

The Infra API does not provide information about blocking, home and exit signals. Thus we assume that all signal that are not related to any station (rautatieliikennepaikka) are blocking. Signals related to stations are always modeled as being "exit". Therefore, the home signals should be fixed by the user by switching the certain exit signals to home.

### Tracks

- TODO

### Mileposts, Mileages and Positions

- TODO


### Switches

- TODO

### Crossings

- TODO

### Speed Limits

- TODO
